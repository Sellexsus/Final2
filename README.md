# Файлы для итогового задания

Дополнено:
Веб сервис предназначен для ведения списка задач с сохранением в базе данных и доступом через REST API.
Пользователь может добавлять задачи, редактировать их, удалять, отмечать выполненными и получать список актуальных заданий.
Система поддерживает повторяющиеся задачи — ежегодные и через N-ое количество дней.

Структура программы:

cmd/migrate/
main.go  Одноразовая утилита для инициализации базы данных. Автоматический запуск базы данных

internal/db/
db.go Содержит функции работы с базой данных

migrate.sql SQL-скрипт таблица миграций.
internal/httpapi/ Пакет, отвечающий за REST API — обработку HTTP-запросов от клиента.

deps.go
Хранит глобальную переменную db *sqlx.DB.
Функция WithDB(d *sqlx.DB) — устанавливает подключение к базе данных для всего пакета httpapi.

nextdate.go
Реализует эндпоинт /api/nextdate (GET и POST).
Служит для расчёта следующей даты повторения задачи по правилу "y" (ежегодно) или "d N" (через N дней).

task_add.go
Обработчик POST /api/task — добавление новой задачи.
Принимает JSON с полями: { "date": "YYYYMMDD", "title": "Задача", "comment": "", "repeat": "" }

task_done.go
Обработчик POST 
Реализует функцию “отметить задачу как выполненную”.

task_item.go
Универсальный обработчик /api/task для операций:
GET /api/task?id=... — получить задачу;
PUT /api/task — обновить задачу (принимает JSON);
DELETE /api/task?id=... — удалить задачу.
Также реализует внутреннюю функцию handleDone() — дополнительная логика для POST /api/task/done.
Использует вспомогательные функции:
handleGet — выборка одной задачи по ID;
handleUpdate — обновление записи;
handleDelete — удаление записи;
parseID — извлекает id из query-параметра.
Все ответы возвращаются в JSON-формате.
При ошибках возвращает {"error": "текст ошибки"}.

tasks_list.go
Обработчик GET /api/tasks.
Возвращает все задачи начиная с указанной даты (from), с лимитом и фильтром по search.

util.go
Вспомогательные функции для всех обработчиков:
jsonError(w, code, msg) — возвращает ошибку в JSON-формате;
writeJSON(w, v) — отправляет любой объект как JSON-ответ;
parseID(r) — извлекает параметр id из URL и преобразует в число.

internal/schedule/
schedule.go — реализует бизнес-логику вычисления повторяющихся задач.
Содержит функции:
NextDate(date, rule) — возвращает следующую дату, начиная от исходной;
NextAfter(date, rule, now) — вычисляет ближайшую дату после now.
Поддерживаемые правила:
"y" — ежегодно (учитывает високосные годы, 29 февраля → 1 марта);
"d N" — через N дней (где 1 ≤ N ≤ 400).
Эта логика используется в обработчиках task_add, task_done и task_item.

main.go (в корне проекта)
Главный исполняемый файл приложения.
Последовательно выполняет:
Открывает базу данных через dbpkg.Open().
Передаёт подключение в пакет HTTP API (api.WithDB(db)).
Регистрирует все маршруты:
/api/task, /api/task/done, /api/tasks, /api/nextdate, /
Подключает обработчик статики (web/).
Запускает сервер на порту 7540 (или на порту, заданном через TODO_PORT).

Задания со звёздочкой не выполнял. 

Во втором комминте: Вынес работу с базой данных в отдельный файл tasks.go в папке internal/db и убрал SQL-запросы из обработчика. Теперь обработчик вызывает функцию из базы, получает список задач и возвращает их в JSON. Также добавил логи в местах, указанных на первом ревью.

В директории `tests` находятся тесты для проверки API, которое должно быть реализовано в веб-сервере.

Директория `web` содержит файлы фронтенда.